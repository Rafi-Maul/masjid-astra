<?php	if (!defined('BASEPATH')) exit('No direct script access allowed');		require_once(APPPATH . '_3rd/PHPExcel/PHPExcel.php');				class Excel extends PHPExcel {			private $tempFolder;		private $instance;			public function __construct() {			parent::__construct();			log_message('DEBUG', 'libraries::PHPExcel Class Initialized');						$this->tempFolder = APPPATH . '_tmp';			$this->instance =& get_instance();						$this->cleanFiles($this->tempFolder);				$this->getProperties()				 ->setCreator("Search4Buy")				 ->setLastModifiedBy("Search4Buy")				 ->setTitle("Office 2007 XLSX Report - by Search4Buy")				 ->setSubject("Office 2007 XLSX Report - by Search4Buy")				 ->setDescription("Office 2007 XLSX Report - by Search4Buy")				 ->setKeywords("Report Search4Buy Excel")				 ->setCategory("Report Search4Buy Excel");							}				public function showExcel($name = 'undefined') {					if (is_dir($this->tempFolder)) {				$this->setActiveSheetIndex(0);										$excelFile = $this->tempFolder . "/tmp_{$name}.xlsx";								$objWriter = PHPExcel_IOFactory::createWriter($this, 'Excel2007');				$objWriter->save($excelFile);							$this->instance->load->helper('url');				$urlFile = site_url("system/application/_tmp/tmp_{$name}.xlsx");				echo "<!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\" \"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd\"><html><head><script language='javascript' type='text/javascript'>document.location='{$urlFile}';</script></head></html>";							} else				$this->Error('Invalid path for temporary folder');				}				private function cleanFiles($dir) {			// Delete temporary files every 600 seconds => 10 minutes			$t = time();			$h = opendir($dir);			while ($file = readdir($h)) {				if ((substr($file, 0, 3) == 'tmp') && (substr($file, -5) == '.xlsx')) {					$path = $dir . '/' . $file;					if (($t - filemtime($path)) > 600)						@unlink($path);				}			}			closedir($h);		}					}	/* End of file Excel.php */	